@model IEnumerable<EventsMS.Models.Event>
@{
    ViewData["Title"] = "Events";
}

<div class="container-fluid px-0 mt-4">
    <!-- Page Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-5 gap-3">
        <h2 class="fw-bold mb-0" style="color: var(--text-primary);">All Events</h2>
        <a asp-action="CreateOrEdit" class="btn btn-primary rounded-pill shadow-sm px-4 py-2">
            <i class="bi bi-plus-circle me-2"></i> Create New Event
        </a>
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5 my-5">
            <i class="bi bi-calendar-x display-1 opacity-50" style="color: var(--text-secondary);"></i>
            <h4 class="mt-4" style="color: var(--text-secondary);">No events found</h4>
            <p style="color: var(--text-secondary);">Create your first event to get started.</p>
            <a asp-action="CreateOrEdit" class="btn btn-primary mt-3 rounded-pill">Add Event</a>
        </div>
    }
    else
    {
        <!-- Events Grid -->
        <div class="row g-4">
            @foreach (var item in Model)
            {
                <div class="col-12 col-md-6 col-lg-4 col-xl-3">
                    <div class="card event-card h-100 shadow-sm border-0 overflow-hidden">
                        <!-- Event Image -->
                        <div class="position-relative">
                            <img src="@item.ImageUrl"
                                 class="card-img-top w-100"
                                 style="height: 220px; object-fit: cover;"
                                 alt="@item.Name"
                                 loading="lazy" />
                        </div>

                        <div class="card-body d-flex flex-column p-4" style="background: var(--card-bg);">
                            <!-- Event Name -->
                            <h5 class="card-title fw-bold mb-2" style="color: var(--text-primary); font-size: 1.35rem; line-height: 1.3;">
                                @item.Name
                            </h5>

                            <!-- Category -->
                            <span class="dept-badge mb-3 d-inline-block">
                                @item.Category?.Name
                            </span>

                            <!-- Dates -->
                            <p class="mb-3 small" style="color: var(--text-secondary);">
                                <i class="bi bi-calendar-event me-2 text-primary"></i>
                                @item.StartDate.ToString("dd MMM yyyy") – @item.EndDate.ToString("dd MMM yyyy")
                            </p>

                            <!-- Meals & Fee -->
                            <div class="d-flex flex-wrap gap-2 mb-4">
                                <span class="badge rounded-pill bg-dark-subtle text-primary border border-primary-subtle px-3 py-2 fw-medium">
                                    Meals: @item.MealsOffered
                                </span>

                                @if (item.IsFree)
                                {
                                    <span class="badge rounded-pill bg-success-subtle text-success px-3 py-2 fw-medium">
                                        Free Event
                                    </span>
                                }
                                else
                                {
                                    <span class="badge rounded-pill bg-warning-subtle text-warning px-3 py-2 fw-medium">
                                        Fee: @item.RegistrationFee ৳
                                    </span>
                                }
                        </div>

                        <!-- Description -->
                        <p class="card-text mb-4 flex-grow-1 small" style="color: var(--text-secondary); line-height: 1.5;">
                            @(item.Description?.Length > 110
                                                    ? item.Description.Substring(0, 110) + "..."
                                                    : item.Description ?? "No description provided.")
                    </p>

                            <!-- Buttons -->
                            <div class="mt-auto d-flex gap-2">
                                <a asp-action="Details" asp-route-id="@item.Id"
                                   class="btn btn-sm btn-outline-primary flex-fill rounded-pill">
                                    <i class="bi bi-eye me-1"></i> Details
                                </a>
                                <a asp-action="CreateOrEdit" asp-route-id="@item.Id"
                                   class="btn btn-sm btn-outline-warning rounded-pill">
                                    <i class="bi bi-pencil me-1"></i> Edit
                                </a>
                                <form method="post"
                                      asp-controller="Event"
                                      asp-action="Delete"
                                      asp-route-id="@item.Id"
                                      class="d-inline"
                                      onsubmit="return confirm('Are you sure you want to delete this event?');">

                                    @Html.AntiForgeryToken()

                                    <button type="submit"
                                            class="btn btn-outline-danger btn-sm rounded-pill px-3 py-1"
                                            data-bs-toggle="tooltip"
                                            title="Delete Event">
                                        <i class="bi bi-trash"></i>
                                        <span class="d-none d-md-inline">Delete</span>
                                    </button>

                                </form>

                            </div>
                        </div>
                    </div>
                </div>
                }
        </div>
    }
</div>

<style>
    .event-card {
        border-radius: var(--radius-lg);
        background: var(--card-bg);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: 1px solid var(--border);
    }

        .event-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-md);
        }

    /* Dark mode specific tweaks */
    [data-bs-theme="dark"] .event-card {
        border-color: rgba(59, 69, 92, 0.5);
    }

    [data-bs-theme="dark"] .btn-outline-primary,
    [data-bs-theme="dark"] .btn-outline-warning,
    [data-bs-theme="dark"] .btn-outline-danger {
        --bs-btn-color: var(--text-primary);
        --bs-btn-border-color: rgba(255,255,255,0.18);
        --bs-btn-hover-bg: rgba(255,255,255,0.08);
        --bs-btn-hover-border-color: rgba(255,255,255,0.18);
    }

    [data-bs-theme="dark"] .badge.bg-dark-subtle {
        background-color: #334155 !important;
        color: #93c5fd !important;
    }

    [data-bs-theme="dark"] .dept-badge {
        background: #1e40af33;
        color: #93c5fd;
        border: 1px solid #1e40af55;
    }
</style>